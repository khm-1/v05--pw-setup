# Playwright and Deno for Headless Chrome on Ubuntu Minimal 24

This project provides a robust solution for running Playwright with Google Chrome in a headless environment on an Ubuntu Minimal 24 server. It includes a shell script for automated setup and a Deno script for interacting with the browser, enabling tasks like web scraping, automated testing, and content generation.

## Why this Setup?

Running a full browser environment on a minimal server can be challenging. This setup addresses common hurdles by:

-   **Automating Dependencies:** Handles the installation of Node.js, Playwright, Chromium, and Xvfb.
-   **Virtual Display:** Utilizes Xvfb to create a virtual display, allowing Chrome to run in a non-graphical server environment with a specified resolution (e.g., for consistent screenshot sizes).
-   **Remote Debugging:** Configures Chrome for remote debugging, enabling external tools like Deno (via Puppeteer) to control the browser.
-   **Lightweight Interaction:** Uses Deno, a modern and secure JavaScript/TypeScript runtime, for efficient browser automation.

## Files Included

-   `setup_playwright.sh`: The primary shell script for setting up the environment.
-   `deno_script.ts`: A Deno script demonstrating how to connect to and control the headless Chrome instance.
-   `screenshot.png`: An example screenshot generated by `deno_script.ts` after a successful run.
-   `page_info.log`: A log file containing the URL and title of the page visited by `deno_script.ts`.

## Features at a Glance

-   **Automated Browser Setup:** Installs Playwright and Chromium with all necessary system dependencies.
-   **Configurable Virtual Display:** Sets up Xvfb with a customizable resolution (default: 1920x1024).
-   **Remote Control:** Launches Chrome with remote debugging enabled on port `9222`.
-   **Deno-Powered Automation:** Connects to the headless Chrome instance using Puppeteer (via Deno).
-   **Web Interaction:** Demonstrates navigating to a URL, taking screenshots, and extracting page information.

## Prerequisites

-   An Ubuntu Minimal 24 server instance.
-   Active internet connection for package downloads.

## Getting Started: Setup and Usage

Follow these steps to deploy and run the headless Chrome environment and interact with it:

### Step 1: Transfer the Scripts

Ensure both `setup_playwright.sh` and `deno_script.ts` are present on your Ubuntu server. You can use `scp`, `wget` (if hosted), or paste the content into new files on the server.

### Step 2: Make the Setup Script Executable

Grant execution permissions to the setup script:

```bash
chmod +x setup_playwright.sh
```

### Step 3: Run the Setup Script

Execute the setup script. This process will install Node.js, Playwright, Chromium, Xvfb, and then start the virtual display and the headless Chrome instance.

```bash
./setup_playwright.sh
```

**Important Note on Xvfb:**
If you encounter an error like `Server is already active for display 99` or issues with `Xvfb` not starting, it means a previous X server session might be lingering. Clean it up with:

```bash
sudo killall Xvfb || true
sudo rm /tmp/.X99-lock || true
```

After cleanup, re-run `./setup_playwright.sh`.

### Step 4: Install Deno (if not already present)

If Deno is not installed on your server, run the following command:

```bash
curl -fsSL https://deno.land/install.sh | sh -s -- -y
```

For the `deno` command to be immediately available, you might need to restart your terminal session or explicitly source your shell configuration:

```bash
source ~/.bashrc
```

### Step 5: Execute the Deno Script

With Chrome running in the background, execute the Deno script. It will connect to Chrome, perform the defined actions (visit Google, take screenshot, log info), and then disconnect.

```bash
deno run --allow-net --allow-read --allow-write --allow-env deno_script.ts
```

### Step 6: Verify the Results

Upon successful execution of the Deno script, you will find:

-   `screenshot.png`: A visual capture of the visited webpage.
-   `page_info.log`: A text file detailing the URL and title of the page.

Example `page_info.log` content:

```
URL: https://www.google.com
Title: Google
```

## Customization Options

-   **Target URL:** Modify the `targetUrl` variable within `deno_script.ts` to automate different websites.
-   **Chrome Launch Arguments:** Adjust Chrome's behavior by editing the arguments in `setup_playwright.sh` (e.g., `--headless=new`, `--remote-debugging-port`, `--window-size`).
-   **Virtual Display Resolution:** Change the `1920x1024x24` values in the `Xvfb` command within `setup_playwright.sh` to set a different screen resolution for the virtual display.

## Troubleshooting Common Issues

-   **`Error: Failed to fetch browser webSocket URL`**: This indicates that Chrome is either not running or its remote debugging port (`9222`) is inaccessible. Verify that `setup_playwright.sh` completed without errors and that Chrome is still active. Review `chrome_output.log` for any browser-specific errors.
-   **`command not found`**: Ensure all prerequisite packages are installed and that your system's `PATH` environment variable is correctly configured, especially after installing Deno.
-   **Permissions Errors**: Confirm that scripts have execute permissions (`chmod +x`) and that `sudo` is used for system-level operations when required.

For persistent problems, provide the exact error messages and any relevant log files for further assistance.


